<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.haebub.dao.mypage.MypageMapper">
    <select id="lectureListDtos" parameterType="int" resultType="com.haebub.dto.mypage.LectureListDTO">
        SELECT
          ltitle
        , DATE(ptime) AS 'startDate'
        , DATE_ADD(DATE(ptime), INTERVAL + lperiod DAY) AS 'endDate'
        , tsubject
        , NAME
        , DATE(now()) AS 'now'
        FROM purchase p, lecture l, teacher t, user u
        <where>
                p.lid = l.lid
            AND l.tid = t.tid
            AND t.uid = u.uid
            AND p.uid = #{uid}
            AND DATE_ADD(DATE(ptime), INTERVAL+lperiod DAY) >= DATE(NOW())
        </where>
    </select>
    <select id="getUid" parameterType="string" resultType="int">
        SELECT uid
        FROM user
        WHERE id = #{id}
    </select>
    <select id="paidList" parameterType="int" resultType="com.haebub.dto.mypage.PaidDTO">
        SELECT ptime
        , ltitle
        , lprice
        , tsubject
        , NAME
        , DATE(ptime) AS 'startDate'
        , DATE_ADD(DATE(ptime), INTERVAL + lperiod DAY) AS 'endDate'
        FROM purchase p, lecture l, teacher t, user u
        WHERE p.lid = l.lid
        AND l.tid = t.tid
        AND t.uid = u.uid
        <!-- pstatus 값 수정하기   -->
        AND pstatus = '구매'
        AND p.uid = #{uid}
    </select>
    <select id="getUser" parameterType="int" resultType="com.haebub.dto.User.UserDTO">
        SELECT   id
                ,name
                ,nickname
                ,email
                ,tel
                ,addr
        FROM     user
        where    uid = #{uid}
    </select>
    <update id="userModify" parameterType="com.haebub.dto.User.UserDTO">
        UPDATE user
        SET   nickname = #{nickname}
            , email = #{email}
            , tel = #{tel}
            , addr = #{addr}
        WHERE uid = #{uid}
    </update>
</mapper>