<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.haebub.dao.pay.PaymentMapper">

    <update id="makeCustomer" parameterType="hashmap">
        UPDATE user SET sp_uid = #{sp_uid}
        WHERE email = #{email};
    </update>

    <update id="makeProduct" parameterType="hashmap">
        UPDATE lecture
            SET sp_pcode = #{sp_pcode}
            ,sp_pplan = #{sp_pplan}
        WHERE lid = #{lid}
    </update>

    <insert id="purchaseOne" parameterType="hashmap">
        INSERT INTO purchase(ptime  ,uid  ,lid  ,pstatus  ,sp_ocode)
        VALUES(NOW()  ,#{uid}  ,#{lid}  ,  #{success}  ,#{order_code} )
    </insert>

    <insert id="insertCart" parameterType="hashmap">
        INSERT INTO fav(uid,lid)
        VALUES(#{uid},#{lid})
    </insert>

    <select id="getCartList" parameterType="string" resultType="hashmap">
        SELECT l.lid, l.ltitle, l.lprice , t.tid, u.name
        from fav f INNER JOIN lecture l ON f.lid = l.lid
        INNER JOIN teacher t ON l.tid = t.tid
        INNER JOIN user u ON t.uid = u.uid
        WHERE f.uid=#{uid}
    </select>

    <insert id="insertCartOrder" parameterType="hashmap">
        insert into purchase_test(uid,sp_ocode,p_time)
        values(#{uid},#{sp_ocode},now())
    </insert>
    <select id="getPid" parameterType="string" resultType="int">
        select pid
        from purchase_test
        where sp_ocode=#{sp_ocode}
    </select>
    <insert id="insertItem" parameterType="hashmap">
        insert into pitem(sp_oitem , lid , pid , pistatus)
            values( #{sp_oitem}, #{lid} , #{pid} , '구매' )
    </insert>

</mapper>